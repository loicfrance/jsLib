'use strict';import{GameEvent,GameManager}from"../../game/manager.mjs";import{StandardViewer,UIElement}from"../../game/viewers.mjs";import{Circle,Rect,Vec2}from"../../geometry2d/geometry2d.mjs";import{InputManager,Key,KeyMap,KeyState}from"../../utils/input.mjs";import{Ball,Brick,Paddle}from"./Breakout_Objects.mjs";import{HSVtoRGB,RGBtoHex}from"../../utils/colors.mjs";import{BBCodeToHTML}from"../../utils/tools.mjs";import ScoreView from"./ScoreView.mjs";const gameRect=new Rect(0,0,160,90);const scoreView=
new ScoreView;const GM=new GameManager({gameDt:1/60,realDt:1/60,viewer:new StandardViewer({canvas:document.getElementById("game_canvas"),inGameView:{spanX:gameRect.width,spanY:gameRect.height,center:gameRect.center},cursor:"crosshair",autoResize:{use:true},resolution:{width:1280,height:720}}),onGameEvent:(evt,dT,obj)=>{switch(evt){case GameEvent.GAME_FRAME:if(ball.isOutOfRect(GM.viewer.visibleRect)){GM.stop();gameInit()}break;case GameEvent.OBJECT_DESTROYED:if(obj instanceof Brick)scoreView.addScore(1)}}});
GM.viewer.context.lineWidth=.16;const paddle=new Paddle(new Rect(0,0,20,1));const ball=new Ball(new Circle(Vec2.ZERO,2),Vec2.ZERO);function gameInit(){GM.clearObjects();paddle.setPosition(gameRect.center).moveXY(0,gameRect.height/2-10);ball.setPosition(paddle.getPosition()).moveXY(10,-10);ball.setSpeed((new Vec2(Math.random(),Math.random())).setMagnitude(40));GM.addObjects([ball,paddle]);for(let i=0;i<5;i++)for(let j=0;j<8;j++){const color=HSVtoRGB(i*.2+j*.02,1,1);GM.addObject(new Brick(new Rect(j*
20+1,i*10+1,j*20+19,i*10+9),RGBtoHex(color.r,color.g,color.b)))}scoreView.setScore(0);GM.start()}const Input=new InputManager(document.body);const keyMap=new KeyMap({mapping:[{keys:Key.LEFT,action:"left"},{keys:Key.Q,action:"left"},{keys:Key.A,action:"left"},{keys:Key.RIGHT,action:"right"},{keys:Key.D,action:"right"},{keys:Key.SPACE,action:"pause"},{keys:Key.ENTER,action:"pause"},{keys:Key.ESCAPE,action:"pause"}],callback:(action,keyState)=>{switch(action){case "left":paddle.speed.x=keyState===KeyState.PRESSED?
-60:0;break;case "right":paddle.speed.x=keyState===KeyState.PRESSED?60:0;break;case "pause":if(keyState===KeyState.RELEASED)GM.isRunning()?GM.stop():GM.start();break}}});GM.viewer.addUIElement(scoreView);gameInit();GM.startRendering();keyMap.enable(Input);
